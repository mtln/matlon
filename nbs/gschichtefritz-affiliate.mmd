# Gschichtefritz Affiliate

The **Gschichtefritz Affiliate** system runs as a standalone web application that integrates seamlessly with the existing shop and app backend.  

Affiliates can **register and access a live dashboard** to track their performance. In the default setup, affiliates earn:  
- A fixed commission for every new customer they bring in  
- A percentage of all revenue generated by those customers during their first year  

Customers benefit as well, receiving a **bonus package of free stories** and a **discount on all purchases in the first year**.  

The programme is **fully configurable**:  
- Commission amounts, revenue share percentages, and timeframes  
- Bonus packs and their contents  
- Other conditions tailored to specific affiliate groups  

---

## Technical Integration

The affiliate system was designed to require **minimal changes to the existing shop and app backend codebase**.  

- The **Affiliate Server** exposes an API to the main application, providing affiliate configurations for:  
  - Rendering the public affiliate information page  
  - Applying rebates in the shopping basket  
  - Granting access to bonus package content  

- The shop reports back to the Affiliate Server whenever:  
  - A new customer registers through an affiliate  
  - A purchase is made by an affiliate-linked customer  

---

## Data Management

While the **data models and application code** are kept separate, all data resides in the **same PostgreSQL database** using **dedicated schemas**.  

This approach ensures:  
- Minimal interference during development  
- Maximum flexibility for **reporting and data analysis**


Hereâ€™s an overview.
```{mermaid}
sequenceDiagram
    participant Affiliate
    participant AffiliateApp as Affiliate Application
    participant ShopApp as Shop Application
    participant Customer
    participant DB as PostgreSQL (separate schemas)

    %% Affiliate registers
    Affiliate->>AffiliateApp: Create profile / Register
    AffiliateApp->>DB: Store affiliate profile
    ShopApp->>AffiliateApp: Fetch and cache affiliate configs
  
    %% Customer visits affiliate page
    Customer->>ShopApp: Visit affiliate public info page
  
    %% Customer registers via affiliate
    Customer->>ShopApp: Register (via affiliate link)
    
    %% Customer downloads free stories
    Customer->>ShopApp: Download free stories (bonus pack)
    ShopApp->>AffiliateApp: Notify event (new customer acquired)
    AffiliateApp->>DB: Store new affiliate-customer relation

    %% Customer makes a purchase
    Customer->>ShopApp: Purchase product
    ShopApp->>AffiliateApp: Notify event (purchase by affiliate-linked customer)
    AffiliateApp->>DB: Store purchase / commission
    ShopApp-->>Customer: Apply rebate
  
    %% Affiliate dashboard
    Affiliate->>AffiliateApp: View dashboard / stats
    AffiliateApp->>DB: Query affiliate data
    AffiliateApp-->>Affiliate: Show commissions, revenue

    Note over ShopApp,AffiliateApp: API-based integration  
    Note over DB: Shared database<br/>separate schemas
```
![Gschichtefritz Affiliate Dashboard](gfaffiliate.png)